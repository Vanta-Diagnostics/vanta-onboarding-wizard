<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vanta Sales - Android Download</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --vanta-purple: #662D8F;
      --vanta-indigo: #49489F;
      --vanta-blue: #1C75BA;
      --vanta-teal: #3CC194;
      --vanta-success: #10B981;
      --surface-dark: #1E1E1E;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--surface-dark);
      color: #fff;
      margin: 0;
      min-height: 100vh;
    }

    .hero {
      background: linear-gradient(135deg, var(--vanta-purple) 0%, var(--vanta-indigo) 25%, var(--vanta-blue) 50%, var(--vanta-teal) 100%);
      padding: 48px 24px 56px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 40px;
      background: var(--surface-dark);
      border-radius: 40px 40px 0 0;
    }

    .hero-logo {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.5px;
      margin-bottom: 32px;
      opacity: 0.9;
    }

    .hero-logo span { font-weight: 400; font-size: 14px; opacity: 0.7; margin-left: 6px; }

    .app-icon {
      width: 88px;
      height: 88px;
      border-radius: 22px;
      background: rgba(255,255,255,0.15);
      border: 2px solid rgba(255,255,255,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 40px;
    }

    .app-name {
      font-size: 26px;
      font-weight: 700;
      letter-spacing: -0.3px;
      margin-bottom: 4px;
    }

    .app-version {
      font-size: 13px;
      color: rgba(255,255,255,0.6);
      margin-bottom: 4px;
    }

    .app-publisher {
      font-size: 12px;
      color: rgba(255,255,255,0.4);
    }

    .content {
      max-width: 480px;
      margin: 0 auto;
      padding: 0 20px 48px;
    }

    .download-btn {
      display: block;
      background: linear-gradient(135deg, var(--vanta-blue), var(--vanta-teal));
      border: none;
      color: #fff;
      padding: 18px 32px;
      border-radius: 14px;
      font-size: 17px;
      font-weight: 700;
      font-family: 'IBM Plex Sans', sans-serif;
      width: 100%;
      text-align: center;
      text-decoration: none;
      margin: 24px 0;
      transition: opacity 0.2s, transform 0.1s;
      cursor: pointer;
      letter-spacing: -0.2px;
    }

    .download-btn:hover { opacity: 0.9; color: #fff; }
    .download-btn:active { transform: scale(0.98); }

    .download-btn .icon { margin-right: 8px; font-size: 20px; vertical-align: middle; }

    .file-info {
      text-align: center;
      font-size: 12px;
      color: rgba(255,255,255,0.3);
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
      color: rgba(255,255,255,0.9);
    }

    .install-steps {
      list-style: none;
      padding: 0;
      margin: 0 0 32px;
    }

    .install-steps li {
      display: flex;
      gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      font-size: 14px;
      line-height: 1.5;
      color: rgba(255,255,255,0.75);
    }

    .install-steps li:last-child { border-bottom: none; }

    .step-num {
      min-width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(28,117,186,0.15);
      color: var(--vanta-blue);
      font-size: 13px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .faq-card {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      margin-bottom: 8px;
      overflow: hidden;
    }

    .faq-q {
      padding: 14px 16px;
      font-size: 13px;
      font-weight: 600;
      color: rgba(255,255,255,0.8);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
    }

    .faq-q:hover { background: rgba(255,255,255,0.03); }

    .faq-q .arrow {
      transition: transform 0.2s;
      font-size: 12px;
      color: rgba(255,255,255,0.3);
    }

    .faq-q.open .arrow { transform: rotate(180deg); }

    .faq-a {
      display: none;
      padding: 0 16px 14px;
      font-size: 13px;
      color: rgba(255,255,255,0.5);
      line-height: 1.6;
    }

    .footer {
      text-align: center;
      padding: 24px;
      font-size: 12px;
      color: rgba(255,255,255,0.2);
      border-top: 1px solid rgba(255,255,255,0.04);
    }

    .footer a { color: rgba(255,255,255,0.3); text-decoration: none; }
  </style>
</head>
<body>
  <!-- Hero -->
  <div class="hero">
    <div class="hero-logo">VANTA <span>Diagnostics</span></div>
    <div class="app-icon"><img src="img/vanta-emblem.png" alt="Vanta" style="width:56px;height:56px;object-fit:contain;"></div>
    <div class="app-name">Vanta Sales</div>
    <div class="app-version" id="appVersion">Latest Version</div>
    <div class="app-publisher">Vanta Diagnostics</div>
  </div>

  <!-- Content -->
  <div class="content">
    <a class="download-btn" id="downloadBtn" href="javascript:void(0)" onclick="downloadAPK()">
      <span class="icon">&#11015;</span> Download Latest Version
    </a>

    <div class="file-info" id="fileInfo">Android APK &bull; Requires Android 8.0+</div>

    <!-- Install Steps -->
    <div class="section-title">How to Install</div>
    <ol class="install-steps">
      <li>
        <span class="step-num">1</span>
        <span>Tap <strong>Download Latest Version</strong> above. The APK file will begin downloading.</span>
      </li>
      <li>
        <span class="step-num">2</span>
        <span>When the download completes, tap the notification or open the file from your <strong>Downloads</strong> folder.</span>
      </li>
      <li>
        <span class="step-num">3</span>
        <span>If prompted, tap <strong>"Settings"</strong> and enable <strong>"Allow from this source"</strong>, then go back.</span>
      </li>
      <li>
        <span class="step-num">4</span>
        <span>Tap <strong>Install</strong>. Wait for the installation to complete.</span>
      </li>
      <li>
        <span class="step-num">5</span>
        <span>Tap <strong>Open</strong> to launch Vanta Sales and sign in with your credentials.</span>
      </li>
    </ol>

    <!-- FAQ -->
    <div class="section-title">Troubleshooting</div>

    <div class="faq-card">
      <div class="faq-q" onclick="toggleFaq(this)">
        "Install blocked" or "Unknown sources" warning
        <span class="arrow">&#9660;</span>
      </div>
      <div class="faq-a">
        Android requires you to allow app installations from your browser. When prompted, tap <strong>Settings</strong>, toggle on <strong>"Allow from this source"</strong>, then press Back and try again. This is a one-time setting.
      </div>
    </div>

    <div class="faq-card">
      <div class="faq-q" onclick="toggleFaq(this)">
        Google Play Protect warning
        <span class="arrow">&#9660;</span>
      </div>
      <div class="faq-a">
        Google Play Protect may show a warning for apps not from the Play Store. Tap <strong>"Install anyway"</strong> or <strong>"More details" &gt; "Install without scanning"</strong>. This is expected for enterprise apps distributed outside the Play Store.
      </div>
    </div>

    <div class="faq-card">
      <div class="faq-q" onclick="toggleFaq(this)">
        How do I update the app later?
        <span class="arrow">&#9660;</span>
      </div>
      <div class="faq-a">
        Come back to this page and tap <strong>Download Latest Version</strong> again. Installing the new APK will update your existing app without losing your data. The app may also prompt you to update automatically.
      </div>
    </div>

    <div class="faq-card">
      <div class="faq-q" onclick="toggleFaq(this)">
        Can I get this on iPhone?
        <span class="arrow">&#9660;</span>
      </div>
      <div class="faq-a">
        iPhone users get the app through Apple TestFlight instead. Contact your administrator for a TestFlight invitation.
      </div>
    </div>
  </div>

  <div class="footer">
    &copy; 2026 Vanta Diagnostics &bull; <a href="https://vantadiagnostics.com">vantadiagnostics.com</a>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script>
    const SUPABASE_URL = 'https://jnqspdbtwyrfdlambvkb.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpucXNwZGJ0d3lyZmRsYW1idmtiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc1MTU0MzAsImV4cCI6MjA1MzA5MTQzMH0.EWba2SLuOEVO6-a7MSDu3TZR1bNX4VnYNUB4k7JSeVg';
    const BUCKET = 'app-releases';

    let apkUrl = null;

    $(document).ready(async function() {
      const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      try {
        // List files in the app-releases bucket to find the latest APK
        const { data, error } = await sb.storage
          .from(BUCKET)
          .list('', {
            limit: 100,
            sortBy: { column: 'created_at', order: 'desc' }
          });

        if (data && data.length > 0) {
          // Find the first .apk file
          const apkFile = data.find(f => f.name.toLowerCase().endsWith('.apk'));
          if (apkFile) {
            const { data: urlData } = sb.storage
              .from(BUCKET)
              .getPublicUrl(apkFile.name);

            apkUrl = urlData.publicUrl;

            // Extract version from filename if possible (e.g., vanta-sales-1.0.3.apk)
            const versionMatch = apkFile.name.match(/(\d+\.\d+\.\d+)/);
            if (versionMatch) {
              $('#appVersion').text('Version ' + versionMatch[1]);
            }

            // File size
            const sizeMB = (apkFile.metadata?.size || apkFile.size || 0) / (1024 * 1024);
            if (sizeMB > 0) {
              $('#fileInfo').html('Android APK &bull; ' + sizeMB.toFixed(1) + ' MB &bull; Requires Android 8.0+');
            }
          }
        }
      } catch (e) {
        console.error('Failed to load APK info:', e);
      }

      if (!apkUrl) {
        $('#downloadBtn')
          .text('No APK available yet')
          .css({ opacity: 0.5, cursor: 'not-allowed' })
          .removeAttr('onclick');
      }
    });

    function downloadAPK() {
      if (!apkUrl) return;
      // Use a dynamic anchor to trigger download without navigating away
      var a = document.createElement('a');
      a.href = apkUrl;
      a.download = '';
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function toggleFaq(el) {
      const $q = $(el);
      const $a = $q.next('.faq-a');
      $q.toggleClass('open');
      $a.slideToggle(200);
    }
  </script>
</body>
</html>
